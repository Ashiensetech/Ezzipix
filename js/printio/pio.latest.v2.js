/* printio_widget@v2.13.1,  licensed. http://print.io */!function(a){var b=function(){var b={v:"1",hasOpenChannel:!1,opts:{},lastOpts:{},fallbackCountry:"",hadConfig:!1,fns:{},hasLocalStorage:!1,hadHistWire:!1,pHist:[],pHistPointer:0},c=this,d=-1!==a.navigator.userAgent.toUpperCase().indexOf("MSIE 9"),e=function(a){var c=b.lastOpts.uniqueUserId?"pio."+b.v+"."+b.lastOpts.uniqueUserId+"."+a:"pio."+b.v+"."+a;return c},f={recipeId:"",url:"https://staging-widget.print.io/widget/",debug:!1,embedInElement:!1,images:[],items:[],canUseUpload:!0,skipProductDetails:!1,canBuyOtherProducts:!0,canUseMap:!0,alwaysUseSingleTemplate:!1,hideComingSoonProducts:!1,goTo:"",goToCustomize:!1,orderId:null,usePushState:!0,fadeBackground:!0,countryCode:"",currencyCode:"",languageCode:"",preLoad:{on:!1},fns:{onCartChange:function(a){},onClose:function(){},onOpen:function(){},onEvent:function(){},onPhotoSourceReq:function(a,b){}},style:{showHeader:!0,cssUrl:""},photosources:{local:{enabled:!0,sortOrder:1},facebook:{enabled:!0,sortOrder:2},instagram:{enabled:!0,sortOrder:3},photobucket:{enabled:!0,sortOrder:4},flickr:{enabled:!0,sortOrder:5},google:{enabled:!0,sortOrder:6},dropbox:{enabled:!0,sortOrder:7},custom:{sortOrder:8,enabled:!1,iconUrl:""}},iframeStyles:{},vars:{},helpUrl:"",productsUrl:"",confirmationUrl:"",supportEmail:"",coupon:null,disableEditInCart:null,preserveCollection:null,uniqueUserId:null,restoreCurrency:!0,hideResumeItemPopup:!1},g=function(a){return void 0===a},h=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},i=function(a,c){var d=b;return d.fns.hasOwnProperty(a)?d.fns[a].apply(d.fns[a],c):void 0},j=function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null==c?"":decodeURIComponent(c[1].replace(/\+/g," "))},k=function(){return a&&a.console?function(){console.log.apply(console,arguments)}:function(){}},l=function(a,b){var c={};if(!b)return a;for(var d in a)b.hasOwnProperty(d)?h(a[d])?c[d]=b[d].slice(0):c[d]=b[d]:h(a[d])?c[d]=a[d].slice(0):c[d]=a[d];return c},m=function(b){var c=a.location,d=c.protocol+"//"+c.hostname,e=c.pathname,f=c.port;return f&&80!=f&&(d+=":"+f),d+="/",b?e.lastIndexOf("/")<1?d:d+e.substr(1,e.lastIndexOf("/")+1):d},n=function(){var c=b.lastOpts,d=document.createElement("iframe"),e=d.style,f=c.style,h=c.url,i=c.languageCode,j=c.recipeId,k=c.countryCode,l=b.fallbackCountry,m=c.preLoad.on;if(i=i||"en","/"!=h[h.length-1]&&(h+="/"),h=h.replace(/^http:\/\//i,"https://"),"https://api.print.io/widget/"===h&&(h="https://widget.print.io/widget/"),"https://staging.widget.print.io/widget/"===h&&(h="https://staging-widget.print.io/widget/"),k&&"gb"===k.toLowerCase()&&(k="uk"),l&&"gb"===l.toString().toLowerCase()&&(l="uk"),(k||l)&&i?(d.src+=h+(k||l).toLowerCase()+"/"+i.toLowerCase()+"/"+j,c.debug&&(d.src+="?debug=true")):(d.src=h+j,(k||i||c.debug||l)&&(d.src+="?",i&&(d.src+="language="+i+"&"),k?d.src+="country="+k+"&":l&&(d.src+="country="+l+"&"),c.debug&&(d.src+="debug=true&"),d.src=d.src.substr(0,d.src.length-1))),d.id="__pio",e.width="98%",e.maxWidth="960px",e.height="700px",!f||g(f.showHeader)||f.showHeader||(e.height="650px"),d.frameBorder=0,d.setAttribute("seamless","seamless"),d.marginHeight=0,d.marginWidth=0,d.hspace=0,d.vspace=0,e.margin="auto",e.boxSizing="border-box",e.borderRadius="5px",e.overflow="none",e.zIndex=999999,c.embedInElement||(e.position="absolute",e.left=0,e.right=0,f&&f.top?e.top=f.top:e.top=(void 0!==a.pageYOffset?a.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop)+20+"px"),c.iframeStyles)for(var n in c.iframeStyles)e[n]=c.iframeStyles[n];return m&&(d.id="__piop",e.width="0px",e.height="0px"),d},o=function(){return document.getElementById("__pio")},p=function(a){var b=o(),c=document.getElementById("__pio_f"),d=a||i("onClose");a&&(d=!0),(void 0===d||d===!0)&&(b&&b.parentNode.removeChild(b),c&&c.parentNode.removeChild(c));var e=document.getElementById("__piop");e&&e.parentNode.removeChild(e)},q=function(){return!!b.lastOpts.embedInElement&&!b.lastOpts.preLoad.on},r=function(a){q()?b.lastOpts.embedInElement.appendChild(a):document.getElementsByTagName("body")[0].appendChild(a)},s=function(){var a=b.lastOpts,c=document.createElement("div"),d=c.style;!a.fadeBackground||q()||a.preLoad.on||document.getElementById("__pio_f")||(d.position="absolute",d.top="0px",d.left="0px",d.width="100%",d.height=Math.max(document.documentElement.scrollHeight,document.height||document.documentElement.clientWidth)+"px",d.background="rgba(0,0,0,.7)",d.zIndex=999998,c.id="__pio_f",document.getElementsByTagName("body")[0].appendChild(c),c.addEventListener("click",function(){p()}))},t=!0,u=function(d){var e=b.lastOpts;if("close"===d.cmd)p();else if("hi"===d.cmd)A("set-options",b.lastOpts);else if("onCartChange"===d.cmd)F(d.data);else if("onChangeCountry"===d.cmd)null!=d.data&&c.setFallbackCountry(d.data);else if("paypal"===d.cmd){var f=document.createElement("div"),g=a.location.toString();b.lastOpts.confirmationUrl&&(g=b.lastOpts.confirmationUrl),f.innerHTML=d.data.replace("!RRR!",g),document.body.appendChild(f);var h=document.getElementsByClassName("js-paypal-form")[0];h.submit()}else if("analytics-addTransaction"===d.cmd)a.ga&&ga("ecommerce:addTransaction",d.data);else if("analytics-addItem"===d.cmd)a.ga&&ga("ecommerce:addItem",d.data);else if("analytics-send"===d.cmd)a.ga&&ga("ecommerce:send");else if("analytics-event"===d.cmd)a.ga&&ga("send",d.data);else if("analytics-pageview"===d.cmd)a.ga&&ga("send","pageview",d.data);else if("open-page"===d.cmd)d.data&&a.open(d.data,"_blank");else if("redirect-to-page"===d.cmd)d.data&&a.location.replace(d.data);else if("help-page"===d.cmd)b.lastOpts.helpUrl&&a.open(b.lastOpts.helpUrl,"_blank");else if("section-init"===d.cmd){if(d.data.tplName&&e.usePushState){if(t&&(I(),t=!1),!b.justPopped){var j=d.data.tplName;a.history.pushState({n:j},"","")}b.justPopped=!1}}else if("order-confirmation"===d.cmd){var k=b.lastOpts.confirmationUrl;k&&(k+=k.indexOf("?")>0?"&orderid="+d.data:"?orderid="+d.data,a.location.replace(k))}else"should-preload"===d.cmd?document.getElementById("__piop")&&A("do-preload",{}):"onGalleryChange"===d.cmd?E("images",d.data):"onChangeCurrency"===d.cmd?null!=d.data&&E("currencyCode",d.data.Code):"custom-photosource-req"===d.cmd&&b.fns&&b.fns.onPhotoSourceReq&&b.fns.onPhotoSourceReq(d.data,function(a){A("custom-photosource-reply",a)});i("onEvent",[d.cmd,d.data])},v=function(a){if("string"==typeof a.data){var b=a.data||a.originalEvent.data,c=b.split("~pio~");if(!(c.lenght<2||0!==b.indexOf("~pio~"))&&(b=JSON.parse(c[1]),b&&b.data&&b.data.cmd&&(b.hasOwnProperty("PIOF")||b.hasOwnProperty("PIOP")))){var d=b.data;u(d)}}};this._m=function(a){u(a)};var w=!1,x=function(){b.hasLocalStorage=C();var d=D("countryCode");if(d?b.fallbackCountry=d:J(),!w){var e=a.location.toString(),f=(-1!==e.indexOf("paypalreturn")&&-1!==e.indexOf("orderid"),j("orderid"));f&&c.clearCart(),w=!0}},y=function(a,b,c){var d=z(a,b),e=new XMLHttpRequest;e.onreadystatechange=function(){var a="undefined"!=typeof XMLHttpRequest.Done?XMLHttpRequest.Done:4;if(e.readyState==a)if(200==e.status)if(e.responseText){var b=JSON.parse(e.responseText);b&&b.cartData?(F(b.cartData),c(b.cartData)):(console.log("PIO: Invalid account data."),c(null))}else console.log("PIO: No account data for that account."),c(null);else console.log("PIO: getAccount unsuccessful."),c(null)},e.open("GET","https://printio-accounts.appspot.com/accounts/"+d),e.send()},z=function(a,c){var d=/^[a-zA-Z0-9_-]{3,}$/;return d.test(c)?(b.lastOpts.uniqueUserId=c,a+c):void console.log("PIO: Invalid uniqueUserId.")},A=function(a,b){var c=document.getElementById("__pio")||document.getElementById("__piop"),e={PIOP:!0,cmd:a,data:b};d&&(e=JSON.stringify(e)),c.contentWindow.postMessage(e,"*")},B=function(){b.hasOpenChannel||(a.addEventListener("message",v,!1),b.hasOpenChannel=!0)},C=function(){try{return"localStorage"in a&&null!==a.localStorage}catch(b){return!1}},D=function(a){var c,d=b.fns.getVal;return d?c=d(e(a)):b.hasLocalStorage&&(c=localStorage[e(a)]),c?JSON.parse(c):void 0};this.getLocal=function(a){return"debug"!==a?void 0:D(a)};var E=function(a,c){var d=b.fns.setVal;if(d)return d(e(a),c?JSON.stringify(c):null);var f=function(){localStorage[e(a)]=c?JSON.stringify(c):null};if(b.hasLocalStorage)try{f()}catch(g){_(localStorage).keys().filter(function(a){return 0!==a.indexOf("pio.")}).each(function(a){return localStorage.removeItem(a),!0}),f()}};this.setLocal=function(a,b){"debug"===a&&E(a,b)};var F=function(a){var c="cart";a?E(c,a):E(c,null),b.fns&&b.fns.onCartChange&&b.fns.onCartChange(a)},G=function(a,b,c){if(null!=a&&null!=b&&null!=c)y(a,b,c);else{var d=D("cart");if(d){var e=new Date,f=new Date(e-864e5);if(Date.parse(d.timeStamp)>f)return d}}},H=function(){return D("images")},I=function(){b.lastOpts.usePushState&&history.pushState&&(b.justPopped=!1,history.pushState({n:{open:!0}},"",""),b.hadHistWire||(a.addEventListener("popstate",function(d){var e=d.state;e&&e.n&&(k()("PIO: POP! "+e.n),e.n.open!==!0?(b.justPopped=!0,c.msg("goto",e.n)):(c.close(),a.history.go(-1)))}),b.hadHistWire=!0))},J=function(){var b=a.document;b.addEventListener("DOMContentLoaded",function(a){var c,d="pio-js-country",e=b.getElementsByTagName("script")[0];b.getElementById(d)||(c=b.createElement("script"),c.id=d,c.async=!0,c.src="//printio-geo.appspot.com/ip/jsonp?callback=PIO._c",e?e.parentNode.insertBefore(c,e):b.head.appendChild(c))})},K=function(a,b,c){if(null==a||null==b||null==c){var d=G();return d&&d.items?d.items:[]}G(a,b,c)},L=function(){var a=b.opts.style,c=!1;b.opts=l(b.opts,{images:[],items:[],goTo:"",goToCustomize:!1,orderId:null}),a&&a.cssUrl&&0!==a.cssUrl.indexOf("http")&&0!==a.cssUrl.indexOf("//")&&(0!==a.cssUrl.indexOf("/")&&(c=!0),a.cssUrl=m(c)+a.cssUrl)},M=function(a){var b=function(b){return validItem=!1,a.images.length>0&&(validItem=!0),a.items.forEach(function(a){a.images&&a.images.length>0&&(validItem=!0)}),validItem?!0:(k()("PIO: Options '"+b+"' Error: Images not provided in PIO options."),!1)},c=function(b){return a.items.length<1?(k()("PIO: Options '"+b+"' Error: 'items' array not found in PIO options."),!1):!0},d=function(b){return validItem=!1,a.items.forEach(function(a){a.productId&&(validItem=!0)}),validItem?!0:(k()("PIO: Options '"+b+"' Error: 'items' array must include at least one item with a 'productId'."),!1)},e=function(b){return validItem=!1,a.items.forEach(function(a){(a.sku||121==a.productId||122==a.productId)&&(validItem=!0)}),validItem?!0:(k()("PIO: Options '"+b+"' Error: 'items' array must include at least one item with a 'sku'."),!1)},f=function(b){return validItem=!1,a.items.forEach(function(a){(a.templateName||a.template||121==a.productId||122==a.productId)&&(validItem=!0)}),validItem?!0:(k()("PIO: Options '"+b+"' Error: 'items' array must include at least one item with a 'templateName' or 'template'."),!1)};if(!a.recipeId)return k()("PIO: Recipe ID not provided in PIO options."),!1;if(!a.url)return k()("PIO: Widget URL not provided in PIO options."),!1;if(a.canUseUpload===!1){var g=b("canUseUpload");if(!g)return!1}if(a.goTo){var h={"tpl-product-a":"tpl-product-a","tpl-product-b":"tpl-product-b","tpl-newcustomize":"tpl-newcustomize","tpl-templates":"tpl-templates","tpl-newupload":"tpl-newupload","tpl-edit":"tpl-edit","tpl-multiedit":"tpl-multiedit","tpl-cart":"tpl-cart",products:"tpl-product-a",details:"tpl-product-b",options:"tpl-newcustomize",templates:"tpl-templates",upload:"tpl-newupload",edit:"tpl-edit",prints:"tpl-multiedit",cart:"tpl-cart"};if(!h.hasOwnProperty(a.goTo))return k()("PIO: Options goTo '"+a.goTo+"' is not allowed."),!1;switch(a.goTo=h[a.goTo],a.goTo){case"tpl-product-b":var g=c("goTo tpl-product-b")&&d("goTo tpl-product-b");return g;case"tpl-newcustomize":var g=c("goTo tpl-newcustomize")&&d("goTo tpl-newcustomize");return g;case"tpl-templates":var g=c("goTo tpl-templates")&&d("goTo tpl-templates")&&e("goTo tpl-templates");return g;case"tpl-newupload":var g=c("goTo tpl-newupload")&&d("goTo tpl-newupload")&&e("goTo tpl-newupload")&&f("goTo tpl-newupload");return g;case"tpl-edit":var g=c("goTo tpl-edit")&&d("goTo tpl-edit")&&e("goTo tpl-edit")&&f("goTo tpl-edit")&&b("goTo tpl-edit");return g;case"tpl-multiedit":var g=c("goTo tpl-multiedit")&&d("goTo tpl-multiedit")&&b("goTo tpl-multiedit");return g}}return!0},N=function(){b.opts.preLoad.on&&setTimeout(function(){b.lastOpts.url||c.open({fromPreLoad:!0})},1e3)};this.config=function(a,c){var d=D("debug");d===!0&&(f.debug=!0);var e=l(f,a||{});b.opts=e,b.fns=e.fns,x(),b.opts.fns&&delete b.opts.fns,c&&c(b),L(),b.hadConfig=!0,N()},this.open=function(a,d){k()("open:",a);var e=a;b.lastOpts.preLoad&&null!=e.preLoad&&null!=b.lastOpts&&null!=b.lastOpts.preLoad&&b.lastOpts.preLoad.hadPreLoad&&(e.preLoad.on=!1),e&&!e.fromPreLoad&&(e.preLoad&&e.preLoad.on||b.opts.preLoad&&b.opts.preLoad.on)&&(e.preLoad={on:!1},b.opts.preLoad.on=!1),b.lastOpts={},b.hadConfig?b.lastOpts=l(l(f,b.opts),{}):b.lastOpts=l(f,{}),e&&z(e.recipeId,e.uniqueUserId),!e||g(e.restoreCurrency)||e.restoreCurrency||(b.lastOpts.restoreCurrency=!1),e&&!e.currencyCode&&b.lastOpts.restoreCurrency&&(e.currencyCode=D("currencyCode")),b.lastOpts=l(b.lastOpts,e||{}),e&&e.fns&&(b.hadConfig?b.fns=l(b.fns,e.fns):b.fns=l(f.fns,e.fns),delete b.lastOpts.fns);var h=M(b.lastOpts);if(h){if(x(),K().forEach(function(a){b.lastOpts.items.push(a)}),e&&e.preserveCollection){var i=c.getImages();null!=i&&(i.push.apply(i,e.images?e.images:[]),b.lastOpts.images=i)}p(!0),B(),s(),r(n()),b.lastOpts.fns&&delete b.lastOpts.fns,b.lastOpts.embedInElement&&(b.lastOpts.embedInElement=null),b.lastOpts.preLoad.on&&(b.lastOpts.preLoad.hadPreLoad=!0,b.lastOpts.preLoad.on=!1),b.opts.preLoad&&(b.opts.preLoad.on=!1),d&&d(b),b.fns.onOpen&&b.fns.onOpen(),t=!0}},this.getOptions=function(){return b.lastOpts},this.close=function(){u({cmd:"close",data:{}}),b.justPopped=!1},this.msg=function(a,b){b=b||1,A(a,b)},this.showCart=function(a){o()?A("goto","tpl-cart"):(a=a||{},a.goTo="tpl-cart",c.open(a))},this.clearCart=function(){F(null)},this.getCart=G,this.getNumItems=function(a,b,c){if(x(),null==a||null==b||null==c){var d=K();return d.length?d.reduce(function(a,b){return a+=b.quantity},0):0}K(a,b,function(a){c(a&&a.items?a.items.length:0)})},this.getImages=H,this._c=this.setFallbackCountry=function(a){b.fallbackCountry=a,E("countryCode",a)},x()};a.PIO=new b,a.PIO.ctor=b}(window);